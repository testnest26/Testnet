<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>EdTech Startup</title>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;margin:0;background:#f4f6f9}
header{background:#1e272e;color:white;padding:15px;text-align:center;font-size:22px}
.container{max-width:900px;margin:auto;padding:20px}
.card{background:white;padding:20px;margin-bottom:20px;border-radius:8px}
input,textarea{width:100%;padding:8px;margin:5px 0}
button{padding:10px;background:#27ae60;color:white;border:none;margin-top:8px;width:100%;cursor:pointer}
.timer{color:red;font-weight:bold;font-size:18px}
.lock{color:red;font-weight:bold}
</style>
</head>

<body>

<header>My EdTech Platform</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
<h3>Login with Mobile OTP</h3>
<input type="text" id="phone" placeholder="+91XXXXXXXXXX">
<div id="recaptcha-container"></div>
<button onclick="sendOTP()">Send OTP</button>

<input type="text" id="otp" placeholder="Enter OTP">
<button onclick="verifyOTP()">Verify OTP</button>
</div>

<!-- MAIN APP -->
<div id="app" style="display:none">

<!-- ADMIN -->
<div class="card">
<h3>Admin Panel</h3>
<input type="password" id="adminPass" placeholder="Admin Password">
<button onclick="unlockAdmin()">Unlock</button>

<div id="adminSection" style="display:none">

<input type="text" id="courseName" placeholder="Course Name">
<label><input type="checkbox" id="paidCourse"> Paid Course</label>
<button onclick="addCourse()">Add Course</button>

<h4>Add Question</h4>
<input type="text" id="questionText" placeholder="Question">
<input type="text" id="opt1" placeholder="Option 1">
<input type="text" id="opt2" placeholder="Option 2">
<input type="text" id="opt3" placeholder="Option 3">
<input type="text" id="opt4" placeholder="Option 4">
<input type="number" id="correct" placeholder="Correct Option (0-3)">
<input type="number" id="timeLimit" placeholder="Test Time (minutes)">
<button onclick="addQuestion()">Save Question</button>

</div>
</div>

<!-- COURSES -->
<div class="card">
<h3>Available Courses</h3>
<div id="courseList"></div>
</div>

<!-- TEST -->
<div class="card" id="testBox" style="display:none">
<h3 id="testTitle"></h3>
<div class="timer" id="timerDisplay"></div>
<div id="questionArea"></div>
<button onclick="submitTest()">Submit Test</button>
</div>

<!-- LEADERBOARD -->
<div class="card">
<h3>Leaderboard</h3>
<div id="leaderboard"></div>
</div>

</div>
</div>

<script>

/* ==========================
   ðŸ”¥ REPLACE WITH YOUR FIREBASE CONFIG
========================== */
const firebaseConfig = {
  apiKey: "AIzaSyAPML8zK9qgRQbUyv7lMVOtt0c5Osjyw_A",
  authDomain: "testnest-education.firebaseapp.com",
  projectId: "testnest-education",
  storageBucket: "testnest-education.firebasestorage.app",
  messagingSenderId: "1000142199756",
  appId: "1:1000142199756:web:afab8eaa0f6bc638969b69",
  measurementId: "G-0TCQF9WGB3"};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ==========================
   OTP LOGIN
========================== */

window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
  'recaptcha-container',
  { size: 'normal' }
);

function sendOTP(){
  const phone = document.getElementById("phone").value;
  auth.signInWithPhoneNumber(phone, window.recaptchaVerifier)
  .then(result=>{
    window.confirmationResult = result;
    alert("OTP Sent");
  }).catch(e=>alert(e.message));
}

function verifyOTP(){
  const code = document.getElementById("otp").value;
  confirmationResult.confirm(code).then(result=>{
    document.getElementById("loginBox").style.display="none";
    document.getElementById("app").style.display="block";
    loadCourses();
    loadLeaderboard();
  }).catch(()=>alert("Invalid OTP"));
}

/* ==========================
   ADMIN
========================== */

function unlockAdmin(){
  if(document.getElementById("adminPass").value==="admin123")
    document.getElementById("adminSection").style.display="block";
}

function addCourse(){
  const name=document.getElementById("courseName").value;
  const paid=document.getElementById("paidCourse").checked;

  db.collection("courses").doc(name).set({
    paid:paid
  });

  alert("Course Added");
  loadCourses();
}

function addQuestion(){
  const name=document.getElementById("courseName").value;

  db.collection("courses").doc(name)
  .collection("questions")
  .add({
    question:document.getElementById("questionText").value,
    options:[
      document.getElementById("opt1").value,
      document.getElementById("opt2").value,
      document.getElementById("opt3").value,
      document.getElementById("opt4").value
    ],
    correct:parseInt(document.getElementById("correct").value),
    time:parseInt(document.getElementById("timeLimit").value)
  });

  alert("Question Saved");
}

/* ==========================
   LOAD COURSES
========================== */

function loadCourses(){
  const div=document.getElementById("courseList");
  div.innerHTML="";

  db.collection("courses").get().then(snapshot=>{
    snapshot.forEach(doc=>{
      if(doc.data().paid){
        div.innerHTML+=`<p>${doc.id} <span class="lock">(Paid)</span></p>`;
      }else{
        div.innerHTML+=`<button onclick="startTest('${doc.id}')">${doc.id}</button>`;
      }
    });
  });
}

/* ==========================
   TEST SYSTEM
========================== */

let currentQuestions=[];
let timeLeft=0;
let timer;

function startTest(course){
  document.getElementById("testBox").style.display="block";
  document.getElementById("testTitle").innerText=course;

  db.collection("courses").doc(course)
  .collection("questions")
  .get().then(snapshot=>{
    currentQuestions=[];
    snapshot.forEach(doc=>{
      currentQuestions.push(doc.data());
    });
    renderTest();
  });
}

function renderTest(){
  const div=document.getElementById("questionArea");
  div.innerHTML="";
  currentQuestions.forEach((q,i)=>{
    div.innerHTML+=`<p>${i+1}. ${q.question}</p>
    ${q.options.map((o,index)=>
      `<input type="radio" name="q${i}" value="${index}">${o}<br>`
    ).join("")}`;
  });

  timeLeft=currentQuestions[0].time*60;
  timer=setInterval(()=>{
    timeLeft--;
    document.getElementById("timerDisplay").innerText="Time Left: "+timeLeft+" sec";
    if(timeLeft<=0){
      clearInterval(timer);
      submitTest();
    }
  },1000);
}

function submitTest(){
  clearInterval(timer);
  let score=0;

  currentQuestions.forEach((q,i)=>{
    const selected=document.querySelector(`input[name="q${i}"]:checked`);
    if(selected && parseInt(selected.value)===q.correct) score++;
  });

  alert("Score: "+score+"/"+currentQuestions.length);

  db.collection("leaderboard").add({
    user:auth.currentUser.phoneNumber,
    score:score
  });

  loadLeaderboard();
  document.getElementById("testBox").style.display="none";
}

/* ==========================
   LEADERBOARD
========================== */

function loadLeaderboard(){
  const div=document.getElementById("leaderboard");
  div.innerHTML="";

  db.collection("leaderboard")
  .orderBy("score","desc")
  .limit(10)
  .get().then(snapshot=>{
    snapshot.forEach(doc=>{
      div.innerHTML+=`<p>${doc.data().user} - ${doc.data().score}</p>`;
    });
  });
}

</script>
</body>
</html>
